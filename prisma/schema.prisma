generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider  = "postgresql"
  schemas   = ["public"]
}

model Trade {
  id                String   @id @unique @default(uuid())
  accountNumber     String
  quantity          Int
  entryId           String?  @default("")
  closeId           String?  @default("")
  instrument        String
  entryPrice        String
  closePrice        String
  entryDate         String
  closeDate         String
  pnl               Float
  timeInPosition    Float    @default(0)
  userId            String
  side              String?  @default("")
  commission        Float    @default(0)
  createdAt         DateTime @default(now())
  comment           String?
  tags              String[] @default([])
  imageBase64       String?
  videoUrl          String?
  imageBase64Second String?
  groupId           String?  @default("")
  images            String[] @default([])

  @@index([accountNumber])
  @@index([groupId])
  @@schema("public")
}

model TickDetails {
  id        String @id @unique @default(uuid())
  ticker    String
  tickValue Float
  tickSize  Float

  @@schema("public")
}

model Notification {
  id          String    @id @default(cuid())
  userId      String
  title       String
  description String
  createdAt   DateTime  @default(now())
  readAt      DateTime?
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@schema("public")
}

model User {
  id                String            @id @default(cuid())
  email             String            @unique
  auth_user_id      String            @unique
  isFirstConnection Boolean           @default(true)
  language          String            @default("en")
  accounts          Account[]
  dashboardLayout   DashboardLayout?
  groups            Group[]
  moods             Mood[]
  notifications     Notification[]
  synchronizations  Synchronization[]
  tags              Tag[]

  @@index([email])
  @@schema("public")
}

model Synchronization {
  id             String    @id @default(uuid())
  userId         String
  service        String
  accountId      String
  lastSyncedAt   DateTime
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  token          String?
  tokenExpiresAt DateTime?
  dailySyncTime  DateTime?
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, service, accountId])
  @@index([userId])
  @@index([service])
  @@schema("public")
}

model Group {
  id        String    @id @default(uuid())
  name      String
  userId    String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  accounts  Account[]
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([name, userId])
  @@index([userId])
  @@schema("public")
}

model Account {
  id                              String            @id @unique @default(uuid())
  number                          String
  propfirm                        String            @default("")
  drawdownThreshold               Float             @default(0)
  profitTarget                    Float             @default(0)
  isPerformance                   Boolean           @default(false)
  userId                          String
  createdAt                       DateTime          @default(now())
  startingBalance                 Float             @default(0)
  payoutCount                     Int               @default(0)
  trailingDrawdown                Boolean           @default(false)
  trailingStopProfit              Float?
  resetDate                       DateTime?
  consistencyPercentage           Float?            @default(30)
  groupId                         String?
  accountSize                     String?
  accountSizeName                 String?
  activationFees                  Float?
  balanceRequired                 Float?
  dailyLoss                       Float?
  evaluation                      Boolean           @default(true)
  isRecursively                   String?
  maxFundedAccounts               Int?
  maxPayout                       String?
  minDays                         Int?
  minPayout                       Float?
  minTradingDaysForPayout         Int?
  payoutBonus                     Float?
  payoutPolicy                    String?
  price                           Float?
  priceWithPromo                  Float?
  profitSharing                   Float?
  rulesDailyLoss                  String?
  tradingNewsAllowed              Boolean           @default(true)
  trailing                        String?
  autoRenewal                     Boolean           @default(false)
  nextPaymentDate                 DateTime?
  paymentFrequency                PaymentFrequency?
  promoPercentage                 Float?
  promoType                       PromoType?
  renewalNotice                   Int?
  minPnlToCountAsDay              Float?
  group                           Group?            @relation(fields: [groupId], references: [id])
  user                            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  payouts                         Payout[]
  buffer                          Float             @default(0)
  considerBuffer                  Boolean           @default(true)
  shouldConsiderTradesBeforeReset Boolean           @default(true)

  @@unique([number, userId])
  @@index([number])
  @@index([groupId])
  @@index([nextPaymentDate])
  @@schema("public")
}

model Payout {
  id            String   @id @default(uuid())
  amount        Float
  date          DateTime
  createdAt     DateTime @default(now())
  status        String   @default("PENDING")
  accountNumber String
  accountId     String
  account       Account  @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([accountNumber])
  @@schema("public")
}

model DashboardLayout {
  id        String   @id @default(uuid())
  userId    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  desktop   Json     @default("[]")
  mobile    Json     @default("[]")
  user      User     @relation(fields: [userId], references: [auth_user_id], onDelete: Cascade)

  @@index([userId])
  @@schema("public")
}

model Mood {
  id                   String   @id @default(uuid())
  userId               String
  day                  DateTime
  mood                 String
  conversation         Json?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  emotionValue         Int      @default(50)
  hasTradingExperience Boolean?
  journalContent       String?
  selectedNews         String[] @default([])
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, day])
  @@index([userId])
  @@index([day])
  @@schema("public")
}

model Shared {
  id             String    @id @default(uuid())
  userId         String
  slug           String    @unique
  title          String?
  description    String?
  createdAt      DateTime  @default(now())
  expiresAt      DateTime?
  isPublic       Boolean   @default(true)
  viewCount      Int       @default(0)
  accountNumbers String[]
  dateRange      Json
  desktop        Json      @default("[]")
  mobile         Json      @default("[]")

  @@index([userId])
  @@index([slug])
  @@schema("public")
}

model FinancialEvent {
  id          String   @id @default(uuid())
  title       String
  date        DateTime
  importance  String
  type        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  sourceUrl   String?
  country     String?
  lang        String   @default("en")
  timezone    String   @default("UTC")

  @@unique([title, date, lang, timezone])
  @@index([date])
  @@schema("public")
}

model Tag {
  id          String   @id @default(uuid())
  name        String
  description String?
  color       String?  @default("#CBD5E1")
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([name, userId])
  @@index([userId])
  @@schema("public")
}

model Newsletter {
  email     String  @id @unique
  isActive  Boolean @default(true)
  firstName String?
  lastName  String?

  @@index([email])
  @@schema("public")
}

model TradeAnalytics {
  id                 String   @id @default(uuid())
  tradeId            String   @unique
  mae                Float    @default(0)
  mfe                Float    @default(0)
  entryPriceFromData Float?
  priceDifference    Float?
  riskRewardRatio    Float?
  efficiency         Float?
  dataSource         String   @default("DATABENTO")
  ema9               Float?
  ema20              Float?
  ema200             Float?
  vwap               Float?
  computedAt         DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([tradeId])
  @@index([computedAt])
  @@schema("public")
}

model HistoricalData {
  id             String   @id @default(uuid())
  symbol         String
  databentSymbol String
  timestamp      DateTime
  open           Float
  high           Float
  low            Float
  close          Float
  volume         Int
  dataSource     String   @default("DATABENTO")
  createdAt      DateTime @default(now())

  @@unique([symbol, databentSymbol, timestamp])
  @@index([symbol])
  @@index([databentSymbol])
  @@index([timestamp])
  @@schema("public")
}

enum PaymentFrequency {
  MONTHLY
  QUARTERLY
  BIANNUAL
  ANNUAL
  CUSTOM

  @@schema("public")
}

enum PromoType {
  DIRECT
  PERCENTAGE

  @@schema("public")
}
